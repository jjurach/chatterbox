# Epic 3 Task 3.3: Test Wave File Corpus

**Status:** Completed
**Type:** ad-hoc (Research/Documentation)
**Date:** 2026-02-19
**Related Epic:** Epic 3 - Wyoming Protocol Implementation and Validation
**Related Plan:** dev_notes/project_plans/2026-02-18_epic-3-4-wyoming-llm-project-plan.md

---

## Summary

Completed Task 3.3 of Epic 3. Created a standardized test wave file corpus with 15
WAV files generated using Piper TTS, plus a `corpus.json` metadata file and README.

All files are stored in `tests/corpus/` and are version-controlled in the source tree.
The corpus covers 6 categories: home_control, weather, media, utility, environment,
and edge_case (short/long utterances).

---

## Changes Made

### New Directory: `tests/corpus/`

Created test corpus directory with:
- 15 WAV files generated by Piper TTS (`en_US-ljspeech-high` voice model)
- `corpus.json` — machine-readable metadata with expected transcriptions
- `README.md` — documentation covering format, contents, usage, and regeneration

### File List

| File | Expected Text | Category | Duration |
|---|---|---|---|
| `test_001_turn_on_lights.wav` | turn on the lights | home_control | 1.1s |
| `test_002_weather_kansas.wav` | what is the weather in kansas | weather | 1.8s |
| `test_003_turn_off_lights.wav` | turn off the lights | home_control | 1.3s |
| `test_004_play_music.wav` | play some music | media | 1.1s |
| `test_005_weather_tomorrow.wav` | what will the weather be like tomorrow | weather | 1.8s |
| `test_006_set_timer.wav` | set a timer for ten minutes | utility | 1.7s |
| `test_007_short_yes.wav` | yes | edge_case | 0.5s |
| `test_008_short_no.wav` | no | edge_case | 0.5s |
| `test_009_lock_the_door.wav` | lock the front door | home_control | 1.1s |
| `test_010_temperature_inside.wav` | what is the temperature inside | environment | 1.7s |
| `test_011_good_morning.wav` | good morning | edge_case | 0.7s |
| `test_012_long_complex.wav` | what is the current temperature in new york city and will it rain this afternoon | edge_case | 4.6s |
| `test_013_open_garage.wav` | open the garage door | home_control | 1.4s |
| `test_014_is_anyone_home.wav` | is anyone home | environment | 1.0s |
| `test_015_bedroom_lights_dim.wav` | turn on the bedroom lights at fifty percent | home_control | 2.3s |

### Updated: `dev_notes/project_plans/2026-02-18_epic-3-4-wyoming-llm-project-plan.md`

- Marked Task 3.3 as `Status: Completed (2026-02-19)`
- Updated Goal 3 status to `Completed (2026-02-19)`
- Checked all Goal 3 acceptance criteria as met

---

## Audio Format Details

- **Sample Rate:** 22050 Hz (Piper native output; `AudioProcessor` resamples to 16000 Hz before Wyoming transmission)
- **Bit Depth:** 16-bit PCM
- **Channels:** Mono
- **Voice Model:** `en_US-ljspeech-high` (Piper TTS)

---

## Verification

```
$ python3 -c "
import wave, os
corpus_dir = 'tests/corpus'
files = sorted(f for f in os.listdir(corpus_dir) if f.endswith('.wav'))
print(f'Count: {len(files)} WAV files')
for f in files:
    path = os.path.join(corpus_dir, f)
    with wave.open(path) as wf:
        duration_ms = wf.getnframes() / wf.getframerate() * 1000
        print(f'{f}: {wf.getframerate()}Hz, {wf.getsampwidth()*8}bit, {wf.getnchannels()}ch, {duration_ms:.0f}ms')
"
```

Output:
```
Count: 15 WAV files
test_001_turn_on_lights.wav: 22050Hz, 16bit, 1ch, 1103ms
test_002_weather_kansas.wav: 22050Hz, 16bit, 1ch, 1800ms
test_003_turn_off_lights.wav: 22050Hz, 16bit, 1ch, 1300ms
test_004_play_music.wav: 22050Hz, 16bit, 1ch, 1080ms
test_005_weather_tomorrow.wav: 22050Hz, 16bit, 1ch, 1753ms
test_006_set_timer.wav: 22050Hz, 16bit, 1ch, 1730ms
test_007_short_yes.wav: 22050Hz, 16bit, 1ch, 499ms
test_008_short_no.wav: 22050Hz, 16bit, 1ch, 499ms
test_009_lock_the_door.wav: 22050Hz, 16bit, 1ch, 1149ms
test_010_temperature_inside.wav: 22050Hz, 16bit, 1ch, 1730ms
test_011_good_morning.wav: 22050Hz, 16bit, 1ch, 708ms
test_012_long_complex.wav: 22050Hz, 16bit, 1ch, 4586ms
test_013_open_garage.wav: 22050Hz, 16bit, 1ch, 1370ms
test_014_is_anyone_home.wav: 22050Hz, 16bit, 1ch, 1033ms
test_015_bedroom_lights_dim.wav: 22050Hz, 16bit, 1ch, 2287ms
```

```
$ python3 -c "
import json
with open('tests/corpus/corpus.json') as f:
    entries = json.load(f)
print(f'corpus.json: {len(entries)} entries')
for e in entries:
    assert e['file'] and e['expected'] and e['description']
print('All entries valid')
"
```

Output:
```
corpus.json: 15 entries
All entries valid
```

---

## Definition of Done Compliance

- [x] 15 wave files generated (≥10-15 requirement met)
- [x] Files contain varied content (6 categories: home_control, weather, media, utility, environment, edge_case)
- [x] Files generated using Piper TTS (`en_US-ljspeech-high` voice model)
- [x] Files stored in source tree (`tests/corpus/`) for version control
- [x] Expected transcriptions documented (`corpus.json`)
- [x] Wave files cover edge cases (short: 0.5s, long: 4.6s)
- [x] Metadata file created (`corpus.json`)
- [x] Documentation complete (`tests/corpus/README.md`)
- [x] Files verified playable and parseable (wave module + manual check)
- [x] Project plan updated (Task 3.3 and Goal 3 marked Completed)
- [x] Change log created

---

## Known Issues

None. All 15 files generated successfully.

### Note on Sample Rate

The files are stored at 22050 Hz (Piper's native output). This is intentional:
- The `AudioProcessor` resamples to 16000 Hz for Wyoming transmission
- Storing at 22050 Hz preserves original Piper quality
- This matches the existing `test_audio.wav` in `src/wyoming_tester/`

---

## Next Steps (Task 3.4)

Task 3.3 is complete. Task 3.4 (Implement Home Assistant Emulator Core) is now
unblocked. Both Task 3.2 (architecture) and Task 3.3 (corpus) are now complete,
which are the two prerequisites for Task 3.4.
